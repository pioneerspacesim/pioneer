dist: trusty
language: cpp
compiler:
  - gcc
matrix:
  include:
    - env: STATIC_CHECKS=yes
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-6.0
          packages:
            - clang-format-6.0
            - libstdc++6 # >= 4.9 needed for clang-format-6.0

    - env: STATIC_CHECKS=no
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - mesa-common-dev
            - libfreetype6-dev
            - libfreeimage-dev
            - libglew-dev
            - libsigc++-2.0-dev
            - libvorbis-dev
before_install:
  - git clone --depth 1 git://github.com/pioneerspacesim/pioneer-thirdparty.git pioneer-thirdparty
  - cd pioneer-thirdparty/ && autoconf && ./configure && make assimp && make sdl2 && make sdl2_image && cd ../
  #- sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
  #- sudo apt-get update -qq
  #- sudo apt-get install -qq mesa-common-dev libfreetype6-dev libfreeimage-dev libglew-dev libsigc++-2.0-dev libvorbis-dev gcc-4.8 g++-4.8
  #- sudo rm /usr/bin/gcc /usr/bin/g++ # GCC is v4.8 in trusty instances.
  #- sudo ln -s /usr/bin/gcc-4.8 /usr/bin/gcc
  #- sudo ln -s /usr/bin/g++-4.8 /usr/bin/g++
script:
  - if [ "$STATIC_CHECKS" = "yes" ]; then
      sh ./scripts/clang-format.sh
    else
      ./bootstrap && ./configure --with-thirdparty=$(pwd)/pioneer-thirdparty LIBS="-ldl -lrt -lpthread" && make
    fi
